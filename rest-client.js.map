{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap b410917ba14f03d45e39","webpack:///./src/rest-client.js","webpack:///./~/minivents/dist/minivents.commonjs.min.js"],"names":["encodeUrl","data","res","k","noEncode","value","encodeURIComponent","substr","length","RestClient","host","options","conf","resource","undefined","currentOptions","_opts","trailing","shortcut","contentType","encode","JSON","stringify","decode","json","ret","parse","e","console","error","log","method","url","indexOf","replace","xhr","XMLHttpRequest","open","mime","setRequestHeader","parameters","emit","p","Promise","resolve","reject","onreadystatechange","readyState","status","contentTypeHeader","getResponseHeader","responseText","responseContentType","split","send","client","parent","name","id","ctx","self","newId","_clone","_resources","_shortcuts","copy","resName","resources","makeRes","r","constructor","String","Array","map","Object","get","args","_request","post","put","patch","delete","module","exports"],"mappings":"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","file":"rest-client.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"RestClient\"] = factory();\n\telse\n\t\troot[\"RestClient\"] = factory();\n})(this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap b410917ba14f03d45e39","import Events from 'minivents'\n\nfunction encodeUrl(data) {\n    let res = '';\n    for (let k in data) {\n        if (typeof data[k] === 'object' && data[k].noEncode)\n            res += k + '=' + data[k].value + '&';\n        else\n            res += encodeURIComponent(k) + '=' + encodeURIComponent(data[k]) + '&';\n    }\n    return res.substr(0, res.length - 1);\n}\n\nclass RestClient {\n    constructor(host, options) {\n        this.host = host;\n        this.conf(options);\n\n        new Events(this);\n\n        // resource must be super class of RestClient\n        // but fucking js cannot into callable objects, so...\n        // After this call all resource methods will be defined\n        // on current RestClient instance (this behaviour affected by last parameter)\n        // At least this parameters are symmetric :D\n        resource(this, undefined, '', undefined, this);\n    }\n\t\n\t\n    conf(options={}) {\n        let currentOptions = this._opts || {\n            trailing: '',\n            shortcut: true,\n            contentType: 'application/json',\n            'application/x-www-form-urlencoded': {encode: encodeUrl},\n            'application/json': {encode: JSON.stringify, decode: function(json) {\n\t\t\t\t\tvar ret = \"\";\n\t\t\t\t\ttry\n\t\t\t\t\t{\n\t\t\t\t\t\tret = JSON.parse(json);\n\t\t\t\t\t}\n\t\t\t\t\tcatch (e) {\n\t\t\t\t\t\tconsole.error(e);\n\t\t\t\t\t\tconsole.log(json);\n\t\t\t\t\t\tif (json.length > 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (json[0] === '[')\n\t\t\t\t\t\t\t\treturn [];\n\t\t\t\t\t\t\telse if (json[0] === '{')\n\t\t\t\t\t\t\t\treturn {};\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn ret;\n\t\t\t\t}\n\t\t\t}\n        };\n\n        this._opts = Object.assign(currentOptions, options);\n\n        return Object.assign({}, this._opts);\n    }\n\n    _request(method, url, data=null, contentType=null) {\n        if (url.indexOf('?') == -1)\n            url += this._opts.trailing;\n        else\n            url = url.replace('?', this._opts.trailing + '?');\n\n        let xhr = new XMLHttpRequest();\n        xhr.open(method, this.host + url, true);\n\n        if (contentType) {\n            let mime = this._opts[contentType];\n            if (mime && mime.encode)\n                data = mime.encode(data);\n            xhr.setRequestHeader('Content-Type', contentType);\n        }\n\n\t\tlet parameters = {method: method, data:data, url: url, contentType: contentType};\n        this.emit('request', xhr, parameters);\n\n        let p = new Promise((resolve, reject) => {\n            xhr.onreadystatechange = () => {\n                if (xhr.readyState == 4) {\n                    this.emit('response', xhr, parameters);\n                    if (xhr.status == 200 || xhr.status == 201 || xhr.status == 204) {\n                        this.emit('success', xhr, parameters);\n\n                        const contentTypeHeader = xhr.getResponseHeader('Content-Type');\n\n                        if (contentTypeHeader === null) {\n                            let res = xhr.responseText;\n                            resolve(res);\n                        } else {\n                            let responseContentType = xhr.getResponseHeader('Content-Type').split(';')[0];\n                            let mime = this._opts[responseContentType];\n                            let res = xhr.responseText;\n                            if (mime && mime.decode)\n                                res = mime.decode(res);\n\n                            resolve(res);\n                        }\n                    } else {\n                        this.emit('error', xhr, parameters);\n                        reject(xhr);\n                    }\n                }\n            };\n        });\n        xhr.send(data);\n        p.xhr = xhr;\n        return p;\n    }\n}\n\nfunction resource(client, parent, name, id, ctx) {\n    let self = ctx ? ctx : (newId) => {\n        if (newId == undefined)\n            return self;\n        return self._clone(parent, newId);\n    };\n\n    self._resources = {};\n    self._shortcuts = {};\n\n    self._clone = (parent, newId) => {\n        let copy = resource(client, parent, name, newId);\n        copy._shortcuts = self._shortcuts;\n        for (let resName in self._resources) {\n            copy._resources[resName] = self._resources[resName]._clone(copy);\n\n            if (resName in copy._shortcuts)\n                copy[resName] = copy._resources[resName];\n        }\n        return copy;\n    };\n\n    self.res = (resources, shortcut=client._opts.shortcut) => {\n        let makeRes = (resName) => {\n            if (resName in self._resources)\n                return self._resources[resName];\n\n            let r = resource(client, self, resName);\n            self._resources[resName] = r;\n            if (shortcut) {\n                self._shortcuts[resName] = r;\n                self[resName] = r;\n            }\n            return r;\n        };\n\n        // (resources instanceof String) don't work. Fuck you, javascript.\n        if (resources.constructor == String)\n            return makeRes(resources);\n\n        if (resources instanceof Array)\n            return resources.map(makeRes);\n\n        if (resources instanceof Object) {\n            let res = {};\n            for (let resName in resources) {\n                let r = makeRes(resName);\n                if (resources[resName])\n                    r.res(resources[resName]);\n                res[resName] = r;\n            }\n            return res;\n        }\n    };\n\n    self.url = () => {\n        let url = parent ? parent.url() : '';\n        if (name)\n            url += '/' + name;\n        if (id != undefined)\n            url += '/' + id;\n        return url;\n    };\n\n    self.get = (args) => {\n        let url = self.url();\n        if (args)\n            url += '?' + encodeUrl(args);\n        return client._request('GET', url);\n    };\n\n    self.post = (data, contentType = client._opts.contentType) => {\n        return client._request('POST', self.url(), data, contentType);\n    };\n\n    self.put = (data, contentType = client._opts.contentType) => {\n        return client._request('PUT', self.url(), data, contentType);\n    };\n\n    self.patch = (data, contentType = client._opts.contentType) => {\n        return client._request('PATCH', self.url(), data, contentType);\n    };\n\n    self.delete = () => {\n        return client._request('DELETE', self.url());\n    };\n    return self;\n}\n\nmodule.exports = RestClient;\n\n\n\n// WEBPACK FOOTER //\n// ./src/rest-client.js","module.exports=function(n){var t={},e=[];n=n||this,n.on=function(n,e,l){(t[n]=t[n]||[]).push([e,l])},n.off=function(n,l){n||(t={});for(var o=t[n]||e,i=o.length=l?o.length:0;i--;)l==o[i][0]&&o.splice(i,1)},n.emit=function(n){for(var l,o=t[n]||e,i=o.length>0?o.slice(0,o.length):o,c=0;l=i[c++];)l[0].apply(l[1],e.slice.call(arguments,1))}};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/minivents/dist/minivents.commonjs.min.js\n// module id = 1\n// module chunks = 0 1"],"sourceRoot":""}